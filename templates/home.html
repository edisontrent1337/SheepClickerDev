<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Testing Django</title>
  <meta name="description" content="">
  <meta name="edisontrent1337" content="">
  <meta name="keywords" content="">

  {% load staticfiles %}
  <link href="{% static 'css/style.css' %}" type="text/css" rel="stylesheet">
  <link href='https://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700italic' rel='stylesheet'
  type='text/css'>

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>




</head>


<div id="header">

</div>
<div id="content">
  {% load staticfiles %}
  <!-- <img src="{% static 'img/blue_tiled_cube.png' %}" alt="wtf"/>

  <input type="button" class="button" value="Increase Income"/>-->


  <input type="button" class="button_blue" id="mine" value="MINE"/>
  <input type="button" class="button_green" id="upgrade" value="UPGRADE"/>

  <label for="res">Res:</label><span id="ress">0</span></span>
  <span>Update Rate:</span> <span id="uspd">0.02</span></span>
  <span>Level:</span><span id="levesl">1</span>
  <span>Ugrade Cost:</span><span id="cosst">75</span>
  <span>Per Click:</span><span id="perClick">1</span>



  <script>

  var credit = 0; // players credit that can be spent on upgrades
  var perClick = 1; // players profit per mining
  var level = 1; // current player level. increased by upgrade
  var upgradeCost = 75; // score needed to rise level
  var baseCost = 50; // base costs for upgrades
  var loginTime = Date.now();

  var woodRate = 0.001; // rate of wood per 36000 s

  // TODO unchain game logic and view update
  // TODO implement a clever game loop
  // update data every 100ms
  window.setInterval("updateData()", 100); // 10 Tick
  // draw ressources as often as possible
  requestAnimationFrame(updateView);

  /** Update the Data presented in the view */
  function updateView() {
    $('#wood').html(thousandSep(parseInt(credit)));
    $('#upd').html(Math.floor(woodRate * 36000) + '/hr');
    $('#level').html(level);
    $('#cost').html(upgradeCost);
    $('#perClick').html(perClick);
    requestAnimationFrame(updateView);
  }

  /** Update the Data in the model */
  function updateData() {
    addCredit(woodRate);
  }

  /** Increase Credit by given amount (decrease if negative) */
  function addCredit(amount) {
    credit += amount;
    // TODO make '100' variable
    if (credit % 100 == 0) {
      unlockAchievement();
    }
  }

  /** User reached specific milestone (e.g. total score, 1000 credits ...)
  * celebrate it ... with popups!
  */
  function unlockAchievement(data) {
    alert ("Achievement unlocked!");
  }

  /** Increase credit by doing something useful, like clicking a button */
  $('#mine').click (function() {
    addCredit(perClick);
    updateView();
  });

  /** Upgrade player level --> rise credit per second */
  $('#upgrade').click(function() {
    if(credit > upgradeCost) {
      woodRate = woodRate*1.2 + level*0.0001;
      addCredit(-upgradeCost);
      level++;
      baseCost+= 0.10*0.01*level*baseCost;
      upgradeCost = Math.floor(baseCost*level*1.5);

      updateView();
    }
  });

/** Introduces decimal dots as separator for large numbers **/
  function thousandSep(val) {
    return String(val).split("").reverse().join("")
                  .replace(/(\d{3}\B)/g, "$1.")
                  .split("").reverse().join("");
                }

  </script>

</div>

<div id="iconbar">

  {% load staticfiles %}

<!--  <img src="{% static 'img/wood_blue.png' %}" alt="wtf" class="resicon_small"/>
  <img src="{% static 'img/wood.png' %}" alt="wtf" class="resicon_middle"/>
  <img src="{% static 'img/wood.png' %}" alt="wtf" class="resicon_big"/> -->

</div>

<div class="paper" id="resBar">
  {% load staticfiles %}
  <div class="resHolder">
    <section style="width:40%; height:100%;  float:left;  z-index:-1;">
        <span class="resAmount" id="upd" style="text-align:left; padding-left:10px;">0</span>
        <span class="resAmount" id="cost" style="width:70%; margin-left:40%; margin-top:13px; text-align:left; padding-left:10px;">1</span>
    </section>
    <section style="width:60%; display:block;float:left;margin-left:-20px; z-index:30000;">
        <button class="resButton" id="msine"><div id="level" style="overflow:hidden; margin:auto; color:white; font-size:20px; background-color:black; width:20px; height:20px; opacity:0.5;"></div></button>
        <span class="resAmount" id="wood">0</span>
    </section>

  </div>
  <div class="resHolder"><button class="resButton" id="wood2"></button><span class="resAmount">18.223</span></div>
  <div class="resHolder"><button class="resButton" id="wood3"></button><span class="resAmount">4.231</span></div>
  <div class="resHolder"><button class="resButton" id="wood4"></button><span class="resAmount">6.232</span></div>


</div>

<div id="footer"></div>

</body>
</html>
