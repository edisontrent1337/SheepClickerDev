{% extends 'base.html' %}

{% block title %} Sheep's Blog {% endblock %}

{% block content %}
<div class="container">
  <div class="row form-horizontal">
    <h2>Your Level: <span id="level"></span></h2>
    <input type="button" class="btn btn-danger" id="mine" value="SHEAR"/>
    <input type="button" class="btn btn-success" id="upgrade" value="Buy Sheep"/>
    <input type="button" class="btn btn-default" id="upg-worker" value="Buy Worker"/>
  </div>
  <div class="row">
    <h2>Progress</h2>
    <div class="form-horizontal">
      <div class="form-group">
        <label for="res" class="col-xs-2">Credits:</label>
        <span class="col-xs-4" id="res">0000</span>
      </div>
      <div class="form-group">
        <label for="upd" class="col-xs-2">Credit per second:</label>
        <span class="col-xs-4" id="upd">0000</span></span>
      </div>
      <div class="form-group">
        <label for="cost" class="col-xs-2">Sheep Cost:</label>
        <span class="col-xs-4" id="cost">75</span>
      </div>
      <div class="form-group">
        <label for="perClick" class="col-xs-2">Credit per click:</label>
        <span class="col-xs-4" id="perClick">1</span>
      </div>
      <div class="form-group">
        <label for="upg-worker" class="col-xs-2">Worker Cost:</label>
        <span class="col-xs-4" id="upgWorker">50</span>
      </div>
    </div>
  </div>
</div>



<script>

    var credit = 999998; // players credit that can be spent on upgrades
    var perClick = 1; // players profit per mining
    var rate = 1; // amount added to players credit per second
    var level = 1; // current player level. increased by upgrade
    var upgradeCost = 75; // score needed to rise level
    var workerCost = 50; // score needed to buy more workers
    var baseCost = 50;


    $(document).ready( function() {  });

    //update every second
    window.setInterval("updateData()", 1000);

    /** Update the Data presented in the view */
    function updateView() {
      $('#res').html(makeHumanReadable(credit));
      $('#upd').html(makeHumanReadable(rate));
      $('#level').html(level);
      $('#cost').html(upgradeCost);
      $('#perClick').html(perClick);
      $('#upgWorker').html(workerCost);
    }

    /** Update the Data in the model */
    function updateData() {
      addCredit(rate);
      updateView();
    }

    /** Increase Credit by given amount (decrease if negative) */
    function addCredit(amount) {
      credit += amount;

      // TODO make '100' variable
      if (credit % 100 == 0) {
        //unlockAchievement();
      }
    }

    /** User reached specific milestone (e.g. total score, 1000 credits ...)
    * celebrate it ... with popups!
    */
    function unlockAchievement(data) {
      alert ("Achievement unlocked!");
    }

    /** Increase credit by doing something useful, like clicking a button */
    $('#mine').click (function() {
      addCredit(perClick);
      updateView();
    });

    /** Upgrade player level --> rise credit per second */
    $('#upgrade').click(function() {
      if(credit > upgradeCost) {
        rate = Math.floor(rate*1.5 + level);
        addCredit(-upgradeCost);

        level++;
        baseCost+= 0.10*0.01*level*baseCost;
        upgradeCost = Math.floor(baseCost*level*1.5);

        updateView();
       }
    });

    $('#upg-worker').click(function() {
      if (credit > workerCost) {
        perClick += 1;
        addCredit(-workerCost);
        workerCost = Math.round(workerCost * 1.5 + level);

        updateView();
      }
    });


    /** Get a more readable string for big values */
    function makeHumanReadable(value) {
      var suffix = "";
      var prefix = "";

      //TODO switch(value.getPrecision())
      if (credit > 1000000000000000) {
        prefix = (value / 1000000000000000).toPrecision(3);
        suffix = "Quadrillion";
      } else if (value > 1000000000000) {
        prefix = (value / 1000000000000).toPrecision(3);
        suffix = "Trillion";
      } else if (value > 1000000000) {
        prefix = (value / 1000000000).toPrecision(3);
        suffix = "Billion";
      } else if (value > 1000000) {
        prefix = (value / 1000000).toPrecision(3);
        suffix = "Million";
      } else if (value >= 1000) {
        prefix = (value / 1000).toPrecision(4);
        suffix = "Thousand";
      } else {
        prefix = value;
        suffix = "";
      }

      return (prefix + " " + suffix);
    }

</script>

{% endblock %}
